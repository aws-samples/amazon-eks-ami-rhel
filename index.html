
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Build template and runtime resources for the Amazon EKS RHEL AMI">
      
      
      
      
      
        <link rel="next" href="CONTRIBUTING/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Amazon EKS RHEL AMI</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#amazon-eks-ami-rhel-build-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Amazon EKS RHEL AMI" class="md-header__button md-logo" aria-label="Amazon EKS RHEL AMI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EKS RHEL AMI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws-samples/amazon-eks-ami-rhel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/amazon-eks-ami-rhel
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Amazon EKS RHEL AMI" class="md-nav__button md-logo" aria-label="Amazon EKS RHEL AMI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Amazon EKS RHEL AMI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws-samples/amazon-eks-ami-rhel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/amazon-eks-ami-rhel
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Overview
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#announcements" class="md-nav__link">
    <span class="md-ellipsis">
      🔔 Announcements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔔 Announcements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#this-code-base-now-follows-the-amazon-linux-2023-custom-eks-ami-code-base" class="md-nav__link">
    <span class="md-ellipsis">
      This code base now follows the Amazon Linux 2023 custom EKS AMI code base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Getting started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    <span class="md-ellipsis">
      🔢 Pre-requisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minimal-packer-iam-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      🪪 Minimal Packer IAM Permissions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-packer-in-cloudshell" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ Installing Packer in CloudShell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloning-the-github-repository" class="md-nav__link">
    <span class="md-ellipsis">
      🗂️ Cloning the Github repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-the-ami" class="md-nav__link">
    <span class="md-ellipsis">
      👷 Building the AMI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      🔒 Security
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license-summary" class="md-nav__link">
    <span class="md-ellipsis">
      ⚖️ License Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#legal-disclaimer" class="md-nav__link">
    <span class="md-ellipsis">
      📝 Legal Disclaimer
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Community
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribution guidelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="usage/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="usage/rhel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Red Hat Enterprise Linux
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    nodeadm
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            nodeadm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nodeadm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nodeadm/doc/api-concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nodeadm/doc/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nodeadm/doc/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="nodegroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Group Creation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#announcements" class="md-nav__link">
    <span class="md-ellipsis">
      🔔 Announcements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔔 Announcements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#this-code-base-now-follows-the-amazon-linux-2023-custom-eks-ami-code-base" class="md-nav__link">
    <span class="md-ellipsis">
      This code base now follows the Amazon Linux 2023 custom EKS AMI code base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Getting started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    <span class="md-ellipsis">
      🔢 Pre-requisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minimal-packer-iam-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      🪪 Minimal Packer IAM Permissions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-packer-in-cloudshell" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ Installing Packer in CloudShell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloning-the-github-repository" class="md-nav__link">
    <span class="md-ellipsis">
      🗂️ Cloning the Github repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-the-ami" class="md-nav__link">
    <span class="md-ellipsis">
      👷 Building the AMI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      🔒 Security
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license-summary" class="md-nav__link">
    <span class="md-ellipsis">
      ⚖️ License Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#legal-disclaimer" class="md-nav__link">
    <span class="md-ellipsis">
      📝 Legal Disclaimer
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="amazon-eks-ami-rhel-build-specification">Amazon EKS AMI RHEL Build Specification</h1>
<p>This repository contains resources and configuration scripts for building a
custom Amazon EKS AMI running on Red Hat Enterprise Linux with <a href="https://www.packer.io/">HashiCorp Packer</a>. This is
a forked version of the configuration that Amazon EKS uses to create the official Amazon EKS-optimized AMI.</p>
<p><strong>Check out the <a href="https://aws-samples.github.io/amazon-eks-ami-rhel/">📖 documentation</a> to learn more.</strong></p>
<hr />
<h2 id="announcements">🔔 Announcements</h2>
<h3 id="this-code-base-now-follows-the-amazon-linux-2023-custom-eks-ami-code-base">This code base now follows the Amazon Linux 2023 custom EKS AMI code base</h3>
<p>This code base has always followed the <a href="https://github.com/awslabs/amazon-eks-ami">awslabs amazon-eks-ami</a> code base as closely as possible.
* Significant changes were made to that upstream code base to provide EKS support for Amazon Linux 2023.
* Because Amazon Linux 2 is now under extended support, this code base will now follow the Amazon Linux 2023 code base of the upstream repository.
* The <a href="https://aws-samples.github.io/amazon-eks-ami-rhel/nodegroups/">scripts for creating worker node groups</a> have been modified to account for how worker nodes join EKS clusters under the new process.
* The previous code base, which was based on Amazon Linux 2 build scripts, will remain available under the <a href="https://github.com/aws-samples/amazon-eks-ami-rhel/tree/al2-base">al2-base branch</a>.</p>
<h2 id="getting-started">🚀 Getting started</h2>
<p>If you are new to Amazon EKS, we recommend that you follow
our <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">Getting Started</a>
chapter in the Amazon EKS User Guide. If you already have a cluster, and you
want to launch a node group with your new AMI, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/launch-workers.html">Launching Amazon EKS Worker
Nodes</a>.</p>
<h2 id="pre-requisites">🔢 Pre-requisites</h2>
<ul>
<li>RHEL image of your choosing.</li>
<li>Internet connectivity from EC2 for file downloads OR files stored locally in S3 bucket.</li>
<li>You must have <a href="https://www.packer.io/">Packer</a> version 1.8.0 or later installed on your local system, an EC2 Instance in AWS, or in <a href="https://aws.amazon.com/cloudshell/">AWS CloudShell</a>. For more information, see <a href="https://www.packer.io/docs/install/index.html">Installing Packer</a> in the Packer documentation.</li>
<li>You must also have AWS account credentials configured so that Packer can make calls to AWS API operations on your behalf. For more information, see <a href="https://www.packer.io/docs/builders/amazon.html#specifying-amazon-credentials">Authentication</a> in the Packer documentation.</li>
<li>We recommend using AWS CloudShell for simplicity.</li>
</ul>
<h2 id="minimal-packer-iam-permissions">🪪 Minimal Packer IAM Permissions</h2>
<pre><code class="language-bash">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [
        &quot;ec2:AttachVolume&quot;,
        &quot;ec2:AuthorizeSecurityGroupIngress&quot;,
        &quot;ec2:CopyImage&quot;,
        &quot;ec2:CreateImage&quot;,
        &quot;ec2:CreateKeypair&quot;,
        &quot;ec2:CreateSecurityGroup&quot;,
        &quot;ec2:CreateSnapshot&quot;,
        &quot;ec2:CreateTags&quot;,
        &quot;ec2:CreateVolume&quot;,
        &quot;ec2:DeleteKeyPair&quot;,
        &quot;ec2:DeleteSecurityGroup&quot;,
        &quot;ec2:DeleteSnapshot&quot;,
        &quot;ec2:DeleteVolume&quot;,
        &quot;ec2:DeregisterImage&quot;,
        &quot;ec2:DescribeImageAttribute&quot;,
        &quot;ec2:DescribeImages&quot;,
        &quot;ec2:DescribeInstances&quot;,
        &quot;ec2:DescribeInstanceStatus&quot;,
        &quot;ec2:DescribeRegions&quot;,
        &quot;ec2:DescribeSecurityGroups&quot;,
        &quot;ec2:DescribeSnapshots&quot;,
        &quot;ec2:DescribeSubnets&quot;,
        &quot;ec2:DescribeTags&quot;,
        &quot;ec2:DescribeVolumes&quot;,
        &quot;ec2:DetachVolume&quot;,
        &quot;ec2:GetPasswordData&quot;,
        &quot;ec2:ModifyImageAttribute&quot;,
        &quot;ec2:ModifyInstanceAttribute&quot;,
        &quot;ec2:ModifySnapshotAttribute&quot;,
        &quot;ec2:RegisterImage&quot;,
        &quot;ec2:RunInstances&quot;,
        &quot;ec2:StopInstances&quot;,
        &quot;ec2:TerminateInstances&quot;
      ],
      &quot;Resource&quot;: &quot;*&quot;
    }
  ]
}
</code></pre>
<h2 id="installing-packer-in-cloudshell">⚙️ Installing Packer in CloudShell</h2>
<pre><code class="language-bash">sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
sudo yum -y install packer
packer plugins install github.com/hashicorp/amazon

</code></pre>
<h2 id="cloning-the-github-repository">🗂️ Cloning the Github repository</h2>
<pre><code class="language-bash">git clone https://github.com/aws-samples/amazon-eks-ami-rhel.git &amp;&amp; cd amazon-eks-ami-rhel

</code></pre>
<h2 id="building-the-ami">👷 Building the AMI</h2>
<p>A Makefile is provided to build the Amazon EKS Worker AMI, but it is just a small wrapper around
invoking Packer directly. You can initiate the build process by running the
following command in the root of this repository:</p>
<pre><code class="language-bash"># Example for building an AMI with the latest Kubernetes version and the latest RHEL 8.9 AMI
make

# Example for building an AMI with the latest Kubernetes version and the latest RHEL 8.9 AMI in us-gov-east-1 region
make k8s=1.29 ami_regions=us-gov-east-1 aws_region=us-gov-east-1

# Example for building an AMI off of the latest RHEL 9.0.0 AMI in us-east-2 region
make k8s=1.29 source_ami_filter_name=RHEL-9.0.0_HVM-2023*-x86_64-* ami_regions=us-east-2 aws_region=us-east-2

# Example for building a customized DISA STIG compliant AMI, owned by a specific AWS Account in AWS GovCloud us-gov-east-1 region, with binaries stored in a private S3 bucket, an IAM instance profile attached, a user data script to install the AWS Systems Manager agent, and using AWS Systems Manager Session Manager for Packer terminal access.
make k8s=1.29 source_ami_owners=123456789123 source_ami_filter_name=RHEL9_STIG_BASE*2023-04-14* ami_regions=us-gov-east-1 aws_region=us-gov-east-1 binary_bucket_name=my-eks-bucket binary_bucket_region=us-gov-east-1 iam_instance_profile=EC2Role pull_cni_from_github=false ssh_interface=session_manager user_data_file=/path/to/ssm_install.txt

# Check default value and options in help doc
make help
</code></pre>
<p>The Makefile chooses a particular kubelet binary to use per Kubernetes version which you can <a href="Makefile">view here</a>.</p>
<blockquote>
<p><strong>Note</strong>
There is a network routing issue caused by the nm-cloud-setup service that comes preinstalled on RHEL machines. In the AWS <a href="https://aws.amazon.com/blogs/containers/run-amazon-eks-on-rhel-worker-nodes-with-ipvs-networking">Blog</a>, we demonstrate how to disable this service and reboot the EC2 instances as recommended by Red Hat in the following KB <a href="https://access.redhat.com/solutions/6319811">article</a>.</p>
<p><strong>Note</strong>
The default instance type to build this AMI does not qualify for the AWS free tier.
You are charged for any instances created when building this AMI.</p>
<p><strong>Note</strong>
This has been tested on RHEL 8.6+ and RHEL 9+ images with 80+ DISA STIG SCAP scores.</p>
</blockquote>
<h2 id="security">🔒 Security</h2>
<p>For security issues or concerns, please do not open an issue or pull request on GitHub. Please report any suspected or confirmed security issues to AWS Security https://aws.amazon.com/security/vulnerability-reporting/</p>
<h2 id="license-summary">⚖️ License Summary</h2>
<p>This library is licensed under the MIT-0 License. See the LICENSE file.</p>
<h2 id="legal-disclaimer">📝 Legal Disclaimer</h2>
<p>The sample code; software libraries; command line tools; proofs of concept; templates; or other related technology (including any of the foregoing that are provided by our personnel) is provided to you as AWS Content under the AWS Customer Agreement, or the relevant written agreement between you and AWS (whichever applies). You should not use this AWS Content in your production accounts, or on production or other critical data. You are responsible for testing, securing, and optimizing the AWS Content, such as sample code, as appropriate for production grade use based on your specific quality control practices and standards. Deploying AWS Content may incur AWS charges for creating or using AWS chargeable resources, such as running Amazon EC2 instances or using Amazon S3 storage.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.sections"], "search": "assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>